<!DOCTYPE html>
<body>
    <canvas id="keys" width="100%" height="100%">

    </canvas>
    <script>
        window.addEventListener("message", updateImages)

        Sizes = {
            "SMALL": {"x": 4,"y": 4},
            "MEDIUM": {"x": 4,"y": 8},
            "LARGE": {"x": 8,"y": 8}
        }

        function updateImages(message) {
            const messageString = new TextDecoder().decode(message.data.content)
            const data = JSON.parse(messageString)

            const canvas = document.getElementById("keys")
            canvas.width = window.outerWidth - 8
            canvas.height = window.outerHeight - 20
            const ctx = canvas.getContext("2d") 

            for (let x = 0; x < data.rooms.length; x++) {
                for (let y = 0; y < data.rooms[x].length; y++) {
                    console.log(data.rooms[x][y])
                    if (data.rooms[x][y].hasOwnProperty("key") && !data.rooms[x][y].roomshape.startsWith("o_")) {
                        const image = new Image()
                        image.onload = function(event) {
                            ctx.drawImage(image, x * 32, canvas.height - ((y + 1) * 32) + 6)
                        }
                        image.src = "./images/keys/" + data.rooms[x][y].key + ".png"
                    }
                }
            }
        }
    </script>
</body>